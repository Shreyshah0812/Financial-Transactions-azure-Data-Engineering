{
	"name": "mix_sql_insights",
	"properties": {
		"content": {
			"query": "\n--Customer + card relationship\n\nSELECT\n    c.client_id AS customer_id,\n    COUNT(DISTINCT(cd.card_number)) AS total_cards\nFROM [financialdb].[dbo].[transactions_transformed] c\nLEFT JOIN [financialdb].[dbo].[cards_data_transformed] cd\n    ON c.client_id = cd.client_id\nGROUP BY c.client_id;\n\n--Spending per customer\n\nSELECT\n    c.id,\n    COUNT(t.id) AS txn_count,\n    SUM(t.amount) AS total_spend,\n    AVG(t.amount) AS avg_spend\nFROM [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[transactions_transformed] t\n    ON c.id = t.client_id\nGROUP BY c.id\nORDER BY total_spend DESC;\n\n\n--Spending by card type\n\nSELECT\n    cd.card_type,\n    SUM(t.amount) AS total_spend\nFROM [financialdb].[dbo].[transactions_transformed] t\nJOIN [financialdb].[dbo].[cards_data_transformed] cd\n    ON t.card_id = cd.id\nGROUP BY cd.card_type;\n\n\n--Customer-wise transaction volume\n\nSELECT\n    c.id AS customer_id,\n    COUNT(t.id) AS txn_count,\n    SUM(t.amount) AS total_spend\nFROM  [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[transactions_transformed] t\n    ON c.id = t.client_id\nGROUP BY c.id\nORDER BY total_spend DESC;\n\n\n--Credit limit vs spending\n\n\nSELECT\n    c.id,\n    cd.credit_limit,\n    SUM(t.amount) AS total_spend\nFROM [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[cards_data_transformed] cd \nON c.id = cd.client_id\nJOIN  [financialdb].[dbo].[transactions_transformed] t ON cd.id = t.card_id\nGROUP BY c.id, cd.credit_limit;\n\n\n\n--Credit utilization per customer per card\n\nSELECT\n    c.id,\n    cd.id AS card_id,\n    cd.credit_limit,\n    SUM(t.amount) AS total_spend,\n    ROUND((SUM(t.amount)/cd.credit_limit)*100,2) AS utilization_pct\nFROM [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[cards_data_transformed] cd ON c.id = cd.client_id\nJOIN [financialdb].[dbo].[transactions_transformed] t ON cd.id = t.card_id\nWHERE cd.credit_limit > 0\nGROUP BY c.id, cd.id, cd.credit_limit;\n\n--High-risk customer detection\n\nSELECT\n    c.id,\n    c.credit_score,\n    SUM(t.amount) AS total_spend\nFROM [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[transactions_transformed] t\n    ON c.id = t.client_id\nWHERE c.credit_score < 650\nGROUP BY c.id, c.credit_score\nORDER BY total_spend DESC;\n\n\n--Chip vs non-chip card behavior\n\nSELECT\n    cd.has_chip,\n    COUNT(t.id) AS txn_count,\n    SUM(t.amount) AS total_spend\nFROM [financialdb].[dbo].[cards_data_transformed] cd\nJOIN [financialdb].[dbo].[transactions_transformed] t\n    ON cd.id = t.card_id\nGROUP BY cd.has_chip;\n\n--Top merchant per customer\n\nSELECT\n    c.id,\n    SUM(t.amount) AS total_spend\nFROM [financialdb].[dbo].[transactions_transformed] t\nJOIN [financialdb].[dbo].[user_data_transformed] c ON t.client_id = c.id\nGROUP BY c.id\nORDER BY total_spend DESC;\n\n\n--Total spend by customer age group\n\nSELECT\n    CASE\n        WHEN c.current_age < 30 THEN 'Under 30'\n        WHEN c.current_age BETWEEN 30 AND 50 THEN '30-50'\n        ELSE '50+'\n    END AS age_group,\n    SUM(t.amount) AS total_spend\nFROM [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[transactions_transformed] t ON c.id = t.client_id\nGROUP BY\n    CASE\n        WHEN c.current_age < 30 THEN 'Under 30'\n        WHEN c.current_age BETWEEN 30 AND 50 THEN '30-50'\n        ELSE '50+'\n    END;\n\n\n--Customers with multiple card brands\n\nSELECT\n    c.id,\n    COUNT(DISTINCT cd.card_brand) AS brand_count\nFROM [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[cards_data_transformed] cd ON c.id = cd.client_id\nGROUP BY c.id\nHAVING COUNT(DISTINCT cd.card_brand) > 1;\n\n\n--Monthly spending trend per customer\n\nSELECT\n    c.id,\n    YEAR(t.date) AS yr,\n    MONTH(t.date) AS mn,\n    SUM(t.amount) AS monthly_spend\nFROM [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[transactions_transformed] t ON c.id = t.client_id\nGROUP BY c.id, YEAR(t.date), MONTH(t.date);\n\n--Customers spending more than income\n\nSELECT\n    c.id,\n    c.yearly_income,\n    SUM(t.amount) AS total_spend\nFROM [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[transactions_transformed] t ON c.id = t.client_id\nGROUP BY c.id, c.yearly_income\nHAVING SUM(t.amount) > c.yearly_income;\n\n--Low credit score but high usage customers\n\n\nSELECT\n    c.id,\n    c.credit_score,\n    COUNT(t.id) AS txn_count,\n    SUM(t.amount) AS total_spend\nFROM [financialdb].[dbo].[user_data_transformed] c\nJOIN [financialdb].[dbo].[transactions_transformed] t ON c.id = t.client_id\nWHERE c.credit_score < 650\nGROUP BY c.id, c.credit_score\nORDER BY total_spend DESC;\n\n\n--Customers with declining spending trend\n\nSELECT\n    customer_id\nFROM (\n    SELECT\n        c.id AS customer_id,\n        YEAR(t.date) AS yr,\n        SUM(t.amount) AS yearly_spend\n    FROM [financialdb].[dbo].[user_data_transformed] c\n    JOIN [financialdb].[dbo].[transactions_transformed] t ON c.id = t.client_id\n    GROUP BY c.id, YEAR(t.date)\n) yearly\nGROUP BY customer_id\nHAVING MAX(yearly_spend) > MIN(yearly_spend);\n\n--",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "financialdb",
				"poolName": "Built-in"
			},
			"resultLimit": -1
		},
		"type": "SqlQuery"
	}
}