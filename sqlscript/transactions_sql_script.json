{
	"name": "transactions_sql_script",
	"properties": {
		"content": {
			"query": "SELECT TOP (100) [id]\n,[date]\n,[client_id]\n,[card_id]\n,[amount]\n,[use_chip]\n,[merchant_id]\n,[merchant_city]\n,[merchant_state]\n,[zip]\n,[mcc]\n,[errors]\n FROM [financialdb].[dbo].[transactions_transformed];\n\n\n --Total transactions & revenue\nSELECT\n    COUNT(*) AS total_transactions,\n    SUM(amount) AS total_revenue\nFROM [financialdb].[dbo].[transactions_transformed];\n\n--Average transaction value\n\nSELECT\n    AVG(amount) AS avg_transaction_value\nFROM [financialdb].[dbo].[transactions_transformed];\n\n--Top 10 customers by spend\n\nSELECT TOP 10\n    client_id,\n    SUM(amount) AS total_spend\nFROM [financialdb].[dbo].[transactions_transformed]\nGROUP BY client_id\nORDER BY total_spend DESC;\n\n--Transactions by payment type (chip vs swipe)\n\nSELECT\n    use_chip,\n    COUNT(*) AS txn_count,\n    SUM(amount) AS revenue\nFROM [financialdb].[dbo].[transactions_transformed]\nGROUP BY use_chip;\n\n\n--Monthly revenue trend\n\nSELECT\n    DATEFROMPARTS(YEAR(date), MONTH(date), 1) AS month,\n    COUNT(*) AS txns,\n    SUM(amount) AS revenue\nFROM [financialdb].[dbo].[transactions_transformed]\nGROUP BY DATEFROMPARTS(YEAR(date), MONTH(date), 1)\nORDER BY month;\n\n--Merchant performance\n\nSELECT TOP 10\n    merchant_id,\n    merchant_state,\n    COUNT(*) AS txns,\n    SUM(amount) AS revenue\nFROM [financialdb].[dbo].[transactions_transformed]\nGROUP BY merchant_id, merchant_state\nORDER BY revenue DESC;\n\n--Spending by category (MCC)\n\nSELECT\n    mcc,\n    COUNT(*) AS txns,\n    SUM(amount) AS revenue,\n    AVG(amount) AS avg_ticket\nFROM [financialdb].[dbo].[transactions_transformed]\nGROUP BY mcc\nORDER BY revenue DESC;\n\n--Error / decline rate\n\nSELECT\n    errors,\n    COUNT(*) AS occurrences\nFROM [financialdb].[dbo].[transactions_transformed]\nGROUP BY errors\nORDER BY occurrences DESC;\n\n\n--RFM-style customer analysis\n\nSELECT\n    client_id,\n    COUNT(*) AS txn_count,\n    SUM(amount) AS total_spend,\n    AVG(amount) AS avg_ticket,\n    MAX(date) AS last_txn\nFROM [financialdb].[dbo].[transactions_transformed]\nGROUP BY client_id\nORDER BY total_spend DESC;\n\n--High-risk spending spikes (anomaly detection)\n\nWITH stats AS (\n    SELECT\n        id,\n        AVG(amount) AS avg_amt,\n        STDEV(amount) AS std_amt\n    FROM [financialdb].[dbo].[transactions_transformed]\n    GROUP BY id\n)\nSELECT\n    t.*\nFROM [financialdb].[dbo].[transactions_transformed] t\nJOIN stats s\n    ON t.id = s.id\nWHERE s.std_amt IS NOT NULL\n  AND t.amount > s.avg_amt + 3 * s.std_amt\nORDER BY t.amount DESC;\n\n\n--Transaction velocity (burst spending)\n\nSELECT\n    card_id,\n    DATEADD(hour, DATEDIFF(hour, 0, date), 0) AS hour_bucket,\n    COUNT(*) AS txns,\n    SUM(amount) AS spend\nFROM [financialdb].[dbo].[transactions_transformed]\nGROUP BY card_id, DATEADD(hour, DATEDIFF(hour, 0, date), 0)\nHAVING COUNT(*) >= 5\nORDER BY txns DESC;\n\n--Customer dependency on single merchant\n\nWITH m AS (\n    SELECT\n        client_id,\n        merchant_id,\n        SUM(amount) AS spend\n    FROM [financialdb].[dbo].[transactions_transformed]\n    GROUP BY client_id, merchant_id\n),\nt AS (\n    SELECT\n        client_id,\n        SUM(spend) AS total_spend,\n        MAX(spend) AS max_merchant_spend\n    FROM m\n    GROUP BY client_id\n)\nSELECT\n    client_id,\n    max_merchant_spend / total_spend AS merchant_dependency_ratio\nFROM t\nORDER BY merchant_dependency_ratio DESC;\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "financialdb",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}